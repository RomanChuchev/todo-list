<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Timer.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Timer.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useEffect, useState } from "react";
import { Timestamp, updateDoc } from "firebase/firestore";

/**
 * Таймер формата "DD д. hh:mm:ss"
 * По истечении времени помечает задачу выполненной
 *
 * @constructor
 * @param {string} time - Время таймера
 * @param {object} docRef - Ссылка на документ
 * @param {boolean} complete - Состояние поста (выполняется / выполнен)
 * @returns {JSX.Element}
 * @example
 * const [[d, h, m, s], setTime] = useState([days, hours, min, sec]);
 * const tick = () => {
 *   if (d === 0 &amp;&amp; h === 0 &amp;&amp; m === 0 &amp;&amp; s === 0) {
 *     completeTodo();
 *   } else if (h === 0 &amp;&amp; m === 0 &amp;&amp; s === 0) {
 *     setTime([d - 1, 23, 59, 59]);
 *   } else if (m === 0 &amp;&amp; s === 0) {
 *     setTime([d, h - 1, 59, 59]);
 *   } else if (s === 0) {
 *     setTime([d, h, m - 1, 59]);
 *   } else {
 *     setTime([d, h, m, s - 1]);
 *   }
 * };
 */
const Timer = ({ time, docRef, complete }) => {
  // По истечении времени помечает задачу
  async function completeTodo() {
    await updateDoc(docRef, { complete: !complete });
  }
  const timeNow = Timestamp.fromDate(new Date());

  let sec = time.seconds - timeNow.seconds;
  let min = 0;
  let hours = 0;
  let days = 0;

  if (sec > 86400) {
    days = Math.floor(sec / 86400);
    sec = sec % 86400;
  }
  if (sec > 3600) {
    hours = Math.floor(sec / 3600);
    sec = sec % 3600;
  }
  if (sec > 60) {
    min = Math.floor(sec / 60);
    sec = sec % 60;
  }

  const [[d, h, m, s], setTime] = useState([days, hours, min, sec]);

  const tick = () => {
    if (d === 0 &amp;&amp; h === 0 &amp;&amp; m === 0 &amp;&amp; s === 0) {
      completeTodo();
    } else if (h === 0 &amp;&amp; m === 0 &amp;&amp; s === 0) {
      setTime([d - 1, 23, 59, 59]);
    } else if (m === 0 &amp;&amp; s === 0) {
      setTime([d, h - 1, 59, 59]);
    } else if (s === 0) {
      setTime([d, h, m - 1, 59]);
    } else {
      setTime([d, h, m, s - 1]);
    }
  };

  useEffect(() => {
    const timerID = setInterval(() => tick(), 1000);
    return () => clearInterval(timerID);
  });

  return (
    &lt;div>
      &lt;p>{`${d > 0 ? d + " дн." : ""} ${
        h > 0 ? h.toString().padStart(2, "0") + ":" : ""
      }${m.toString().padStart(2, "0")}:${s.toString().padStart(2, "0")}`}&lt;/p>
    &lt;/div>
  );
};

export default Timer;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="App.html">App</a></li><li><a href="Header.html">Header</a></li><li><a href="ItemAddForm.html">ItemAddForm</a></li><li><a href="Timer.html">Timer</a></li><li><a href="TodoEditing.html">TodoEditing</a></li><li><a href="TodoList.html">TodoList</a></li><li><a href="TodoListItem.html">TodoListItem</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Spinner">Spinner</a></li><li><a href="global.html#formattedTime">formattedTime</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Sun Nov 27 2022 21:52:11 GMT+0300 (Москва, стандартное время)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
